# 要件定義書: カテゴリ管理機能の実装

## 1. 目的
投稿記事をカテゴリごとに分類し、管理および閲覧の利便性を向上させる。

## 2. 機能要件

### 2.1. データモデル
*   既存の `Category`, `PostCategory` モデルを使用（`Post` と `Category` は多対多の関係）。

### 2.2. 管理画面 (Admin)
*   **カテゴリ管理 (`/admin/categories`)**:
    *   **一覧表示**: 登録済みカテゴリの一覧を表示。
    *   **新規作成**: 同一画面内に新規作成フォームを設置（ページ遷移なし）。
    *   **編集**: カテゴリ名をクリック、または「編集」ボタンでインライン編集、あるいはモーダルで編集（今回はシンプルに編集モードへの切り替えなどで対応）。
    *   **削除**: 削除ボタンでカテゴリを削除。
    *   *要件変更*: `/admin/categories/new` や `/admin/categories/[id]` の個別ページは作成せず、一覧ページですべて完結させる。

*   **投稿作成・編集 (`/admin/posts/new`, `/admin/posts/[id]`)**:
    *   投稿作成・更新時に、既存のカテゴリ一覧から複数のカテゴリを選択（チェックボックス等）できるUIを追加。
    *   選択されたカテゴリを保存するAPI連携。

### 2.3. 公開画面 (Public)
*   **投稿一覧・詳細**:
    *   記事に関連付けられたカテゴリを表示する（チップスタイル等）。

### 2.4. API
*   `GET /api/categories`: (実装済み) カテゴリ一覧取得。
*   `POST /api/admin/categories`: (実装済み) カテゴリ作成。
*   `PUT /api/admin/categories/[id]`: (実装済み) カテゴリ更新。
*   `DELETE /api/admin/categories/[id]`: (実装済み) カテゴリ削除。
*   **修正**: `GET /api/posts`: カテゴリ情報を含めて返すように変更。
*   **修正**: `GET /api/posts/[id]`: カテゴリ情報を含めて返すように変更。
*   **修正**: `POST /api/admin/posts`: カテゴリID配列を受け取り、`PostCategory`を作成。
*   **修正**: `PUT /api/admin/posts/[id]`: カテゴリID配列を受け取り、`PostCategory`を更新（削除・追加）。

## 3. 実装ステップ
1.  **API修正**: `src/app/api/posts`, `src/app/api/admin/posts` 関連のAPIを修正。
2.  **型定義更新**: フロントエンド用の `Post`, `Category` 型定義を整備。
3.  **管理画面 (カテゴリ) 実装**: `/admin/categories/page.tsx` 一つで一覧・作成・編集・削除を完結させる。
4.  **管理画面 (投稿) 修正**: 投稿フォームにカテゴリ選択機能を追加。
5.  **公開画面修正**: 投稿表示部分にカテゴリ表示を追加。
